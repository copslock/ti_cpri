==================================
Runtime Keystore TISCI Description
==================================

.. _sec_keystore_tisci_desc:

Introduction
============

This section describes the APIs available to manage the Runtime Keystore in
|sysfw|.

+------------------+---------------------------------------------------------------------------+
| TISCI Message ID |                        Message Name                                       |
+==================+===========================================================================+
| 0x900D           | :ref:`TISCI_MSG_KEYSTORE_WRITE <keystore_write>`                          |
+------------------+---------------------------------------------------------------------------+
| 0x900E           | :ref:`TISCI_MSG_KEYSTORE_EXPORT_ALL <keystore_export>`                    |
+------------------+---------------------------------------------------------------------------+
| 0x900F           | :ref:`TISCI_MSG_KEYSTORE_IMPORT_ALL <keystore_import>`                    |
+------------------+---------------------------------------------------------------------------+
| 0x9016           | :ref:`TISCI_MSG_KEYSTORE_GEN_SKEY_FROM_RNG <keystore_gen_skey_from_rng>`  |
+------------------+---------------------------------------------------------------------------+

.. _keystore_write:

TISCI_MSG_KEYSTORE_WRITE - Write the entire keystore contents
-------------------------------------------------------------

Keystore write allows the system designer to perform initial provisioning of
keystore contents. This is the foundational keystore operation required by
|sysfw| in order to use any subsequent keystore or key service API.

The initial keys are generated off-line, packed into the defined keystore
structure, and signed/encrypted with the active MPK/MEK. For details on the
structure contents and how to sign/encrypt, please refer to :ref:`Keystore
Provisioning <pub_keystore_provision>`.

Usage
~~~~~

+------------------------+--------+
| **Message Type**       | Secure |
+------------------------+--------+
| **Secure Queue Only?** | Yes    |
+------------------------+--------+

TISCI Message ID
~~~~~~~~~~~~~~~~

.. sysfwapimacro:: TISCI_MSG_KEYSTORE_WRITE

.. sysfwapistruct:: tisci_msg_keystore_write_req

.. sysfwapistruct:: tisci_msg_keystore_write_resp

.. _keystore_export:

TISCI_MSG_KEYSTORE_EXPORT_ALL - Encrypt and export the contents of the keystore
-------------------------------------------------------------------------------

Usage
~~~~~

+------------------------+--------+
| **Message Type**       | Secure |
+------------------------+--------+
| **Secure Queue Only?** | Yes    |
+------------------------+--------+

TISCI Message ID
~~~~~~~~~~~~~~~~

.. sysfwapimacro:: TISCI_MSG_KEYSTORE_EXPORT_ALL

.. sysfwapistruct:: tisci_msg_keystore_export_req

.. note::

  **Subject to change**: Keystore export requires the host allocate **9984**
  bytes (0x2700) for |sysfw| to copy encrypted contents into.

.. sysfwapistruct:: tisci_msg_keystore_export_resp

.. _keystore_import:

TISCI_MSG_KEYSTORE_IMPORT_ALL - Import and decrypt a previously exported keystore
---------------------------------------------------------------------------------

Usage
~~~~~

+------------------------+--------+
| **Message Type**       | Secure |
+------------------------+--------+
| **Secure Queue Only?** | Yes    |
+------------------------+--------+

TISCI Message ID
~~~~~~~~~~~~~~~~

.. sysfwapimacro:: TISCI_MSG_KEYSTORE_IMPORT_ALL

.. sysfwapistruct:: tisci_msg_keystore_import_req

.. sysfwapistruct:: tisci_msg_keystore_import_resp

.. _keystore_gen_skey_from_rng:

TISCI_MSG_KEYSTORE_GEN_SKEY_FROM_RNG - Generate a symmetric key from RNG and import it into keystore
----------------------------------------------------------------------------------------------------

Usage
~~~~~

+------------------------+--------+
| **Message Type**       | Secure |
+------------------------+--------+
| **Secure Queue Only?** | Yes    |
+------------------------+--------+

TISCI Message ID
~~~~~~~~~~~~~~~~

.. sysfwapimacro:: TISCI_MSG_KEYSTORE_GEN_SKEY_FROM_RNG

.. sysfwapistruct:: tisci_msg_keystore_gen_skey_from_rng_req

.. sysfwapistruct:: tisci_msg_keystore_gen_skey_from_rng_resp
